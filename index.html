<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My embedded Tableau visualization</title>
    <style>
      html, body, tableau-viz, tableau-authoring-viz, tableau-pulse {
        height: 100%;
        width: 100%;
      }
    </style>
</head>
<body>
    <tableau-viz
        src="https://10ay.online.tableau.com/t/forsightanalytics-c7b8da01a7/views/EmailPerformancebyCampaign/EmailPerformancebyCampaign"
        device="desktop"
        hide-tabs
        toolbar="bottom">
    </tableau-viz>

    <script type="module">
        import { SheetType, TableauEventType } from 'https://10ay.online.tableau.com/javascripts/api/tableau.embedding.3.latest.js';

        (async () => {
            const viz = document.querySelector('tableau-viz');

            // ✅ Use the JWT exactly as in the Playground
            viz.token = "eyJhbGciOiJIUzI1NiIsImlzcyI6ImM0ZDQ1OTJmLWJiYmItNGE2MC1iNGY1LTU0NmYwN2IyOWNkMCIsImtpZCI6ImE5MjcwYzg4LWFhMGItNGNmOS1hZGFhLWY3MWZhOTg1MjJjIiwidHlwIjoiSldUIn0.eyJpc3MiOiJjNGQ0NTkyZi1iYmJiLTRhNjAtYjRmNS01NDZmMDdiMjljZDAiLCJleHAiOjE3NDIzNTg1MjgsImp0aSI6ImNhMDQ5MzQzLTc3NWMtNDdlOC05YWFjLTAwN2IzODBkYjFmNCIsImF1ZCI6InRhYmxlYXUiLCJzdWIiOiJcdGZvcnNpZ2h0YW5hbHl0aWNzQGdtYWlsLmNvbSIsInNjcCI6WyJ0YWJsZWF1OnZpZXdzOmVtYmVkIiwidGFibGVhdTp2aWV3czplbWJlZF9hdXRob3JpbmciLCJ0YWJsZWF1Omluc2lnaHRzOmVtYmVkIl19.UoUxe8kjVr-iewxH2WcBdpyrzEkG6mDzIM1VxKwtya8";  // Replace with your real JWT

            await new Promise((resolve, reject) => {
                viz.addEventListener(TableauEventType.FirstInteractive, () => {
                    console.log('✅ Viz is interactive!');
                    resolve();
                });

                viz.addEventListener(TableauEventType.VizLoadError, (error) => {
                    console.error("❌ Viz Load Error:", error.detail);
                    reject(error.detail);
                });
            });

            let dashboard;
            let worksheet;
            if (viz.workbook.activeSheet.sheetType === SheetType.Dashboard) {
                dashboard = viz.workbook.activeSheet;
                worksheet = dashboard.worksheets.find((ws) => ws.name === 'Replace-Name-of-Worksheet');
            } else {
                worksheet = viz.workbook.activeSheet;
            }

        })();
    </script>
</body>
</html>
