<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau Dashboard Embed</title>
    <script type="module" src="https://embedding.tableauusercontent.com/tableau.embedding.3.latest.min.js"></script>
</head>
<body>
    <tableau-viz 
        id="tableauViz"
        src="https://10ay.online.tableau.com/t/forsightanalytics-c7b8da01a7/views/EmailPerformancebyCampaign/EmailPerformancebyCampaign"
        iframe-auth>
    </tableau-viz>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const tableauViz = document.getElementById('tableauViz');

            // ✅ Ensure latest JWT is used
            const token = "eyJhbGciOiJIUzI1NiIsImtpZCI6ImE5MjcwYzg4LWFhMGItNGNmOS1hZGFhLWY3MWZmYTk4NTIyYyIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJjNGQ0NTkyZi1iYmJiLTRhNjAtYjRmNS01NDZmMDdiMjljZDAiLCJleHAiOjE3NDIzNjk0MjYsImp0aSI6ImNlYWJjN2ZkLWY3MGYtNDUwZS05NzhkLThmZjRjMDllZGRmNiIsImF1ZCI6InRhYmxlYXUiLCJzdWIiOiJmb3JzaWdodGFuYWx5dGljc0BnbWFpbC5jb20iLCJzY3AiOlsidGFibGVhdTp2aWV3czplbWJlZCJdfQ.5bXFbfWsvNeYT7jNeJ9xA7dDsOs5EKMcYIhAEDKdRSU";  
            
            // ✅ Force token reset & reapply
            tableauViz.removeAttribute("token");  
            setTimeout(() => {
                tableauViz.setAttribute("token", token);
                console.log("✅ JWT Assigned:", tableauViz.getAttribute("token"));
            }, 500);

            tableauViz.addEventListener("vizLoadError", (e) => {
                console.error("❌ Tableau Viz Load Error:", e.detail);
            });

            tableauViz.addEventListener("firstInteractive", function() {
                console.log("✅ Tableau Viz Loaded Successfully!");
            });
        });
    </script>
</body>
</html>
